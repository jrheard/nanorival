function add(acc, x) {
    return acc + x;
}

function main() {

    // generated by gen_counts.py:
    var COUNTS_BY_DAY = [1603, 3003, 2282, 253, 2422, 3008, 1353, 134, 2765, 981, 839, 1754, 1997, 2184, 1036, 2745, 2551, 2601, 685, 1285, 819, 282, 266, 2030, 701, 2209, 956, 2479, 1256, 1822];

    var today = new Date();
    var dayIndex;
    if (today.getMonth() > 10 || today.getFullYear() > 2023) {
        dayIndex = 30;
        document.getElementById("day-summary").innerText = "NaNoRiVal 2023 is over! Did you win??";
        document.getElementById("cumulative-summary").remove()
        document.getElementById("progress-bar").remove()
    } else {
        dayIndex = today.getDate() - 1;
        today.setDate(today.getDate() - 1);
        if (today.getHours() < 18) {
            // Keel wants each day's number to appear no sooner than 6pm.
            dayIndex -= 1;
        }
    }

    var todaysNumber, sumSoFar;
    if (dayIndex < 0) {
        todaysNumber = 0;
        sumSoFar = 0;
        document.getElementById("day-summary").innerText = "Your rival hasn't started yet, check back later!";
        document.getElementById("cumulative-summary").remove()
        document.getElementById("progress-bar").remove()
        return;
    }

    todaysNumber = COUNTS_BY_DAY[dayIndex];
    sumSoFar = COUNTS_BY_DAY.slice(0, dayIndex + 1).reduce(add, 0);

    document.getElementById("day").innerText = today.toLocaleDateString('en-us', { weekday: "long", month: "short", day: "numeric" });
    document.getElementById("num-words-today").innerText = todaysNumber.toLocaleString("en-us");
    document.getElementById("num-words-cumulative").innerText = sumSoFar.toLocaleString("en-us");


    var progressBarWidth = 800 * (sumSoFar / 50000);
    document.getElementById("inner").style.width = progressBarWidth + "px";
}
